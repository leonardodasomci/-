import yfinance as yf
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
import matplotlib as mpl

# ğŸ“Œ í°íŠ¸ ì„¤ì • (Mac ì „ìš©)
mpl.rcParams['font.family'] = 'AppleGothic'   # ë§¥ ê¸°ë³¸ í•œê¸€ í°íŠ¸
mpl.rcParams['axes.unicode_minus'] = False    # ë§ˆì´ë„ˆìŠ¤ ê¹¨ì§ ë°©ì§€

# ğŸ“ˆ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° (ì‚¼ì„±ì „ì: 005930.KQ = ì½”ìŠ¤ë‹¥, 005930.KS = ì½”ìŠ¤í”¼)
ticker = yf.Ticker("005930.KQ")
data = ticker.history(period="1y")

# ğŸ§® ì´ë™í‰ê· ì„  ê³„ì‚°
data['SMA20'] = data['Close'].rolling(window=20).mean()
data['SMA50'] = data['Close'].rolling(window=50).mean()

# ğŸŸ¢ğŸ”´ ë§¤ìˆ˜Â·ë§¤ë„ ì‹ í˜¸ ê³„ì‚°
data['Signal'] = 0
data['Signal'][20:] = np.where(data['SMA20'][20:] > data['SMA50'][20:], 1, -1)

# ğŸ–¨ï¸ í™•ì¸ (ë§ˆì§€ë§‰ 5ì¤„)
print(data.tail())

# ğŸ“Š ì°¨íŠ¸ ê·¸ë¦¬ê¸°
plt.figure(figsize=(12,6))
plt.plot(data['Close'], label='ì¢…ê°€')
plt.plot(data['SMA20'], label='20ì¼ì„ ')
plt.plot(data['SMA50'], label='50ì¼ì„ ')

# ë§¤ìˆ˜ ì‹ í˜¸ (â–² ì´ˆë¡ìƒ‰)
plt.scatter(data.index[data['Signal'] == 1],
            data['Close'][data['Signal'] == 1],
            marker='^', color='g', label='ë§¤ìˆ˜ ì‹ í˜¸', alpha=1)

# ë§¤ë„ ì‹ í˜¸ (â–¼ ë¹¨ê°„ìƒ‰)
plt.scatter(data.index[data['Signal'] == -1],
            data['Close'][data['Signal'] == -1],
            marker='v', color='r', label='ë§¤ë„ ì‹ í˜¸', alpha=1)

plt.title("ì‚¼ì„±ì „ì ì£¼ê°€ + ì´ë™í‰ê· ì„  ë§¤ë§¤ ì‹ í˜¸")
plt.xlabel("ë‚ ì§œ")
plt.ylabel("ê°€ê²©")
plt.legend()
plt.grid(True)
plt.tight_layout()
plt.show()
